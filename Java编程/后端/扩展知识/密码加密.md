# 密码加密

用户注册时（管理员添加新的账号信息时）的密码必须经过某种算法进行编码，并将得到的结果存储到数据库，而不允许将原始密码直接存储到数据库中！

原始密码通常可以称之为密码的**原文**，或称之为**明文**密码，经过编码处理的结果可称之为**密文**。

如果直接存储明文密码，容易导致用户账号被窃取的安全问题，基于当下主流的网络技术，这类安全问题通常是企业内部管理问题导致的！简单来说，对密码进行加密处理，主要防的就是内部员工（例如能够直接接触到数据库服务器的员工，无论是进入机房或是远程登录）。

早在2011（2012？）年，CSDN就被暴出了明文的账号密码的导出文件！

对明文密码进行编码处理时，**不可以**使用任何**加密算法**，因为**所有加密算法都是可以逆向运算的**，即：根据算法类型、加密参数、密文，可以通过运算得到密码原文！通常，加密算法只是用于保障数据在传输过程中的安全性！

对于需要存储下来的密码，且只需要验证原密码是否匹配，不需要（不允许）通过逆向运算根据密文得到原文时，应该使用**消息摘要算法**对密码原文进行编码处理！

消息摘要算法的典型特征有：

- 消息相同时，摘要必然相同

- 使用固定的某种消息摘要算法时，无论消息的长度多少，摘要的长度是固定的

- 消息不同时，摘要

  极大概率

  不会相同

  - 理论上，必然存在N个不同的消息，通过编码，得到的摘要是完全相同的
  - 由于摘要的种类也非常多，设计得非常好的算法会使得这种概率非常低

- 所有消息摘要算法都是不可以逆向运算的

消息摘要算法的结果通常会使用十六进制数来表示，通常，运算结果相同简单的消息摘要算法的结果长度也有32位十六进制数组成，还原成二进制数就是128个二进制数组成，这样的算法称之“128位算法”，同理，如果某个结果是由64个十六进制数组成，还原成二进制就是256个二进制数，则称之为“256位算法”。

以128位算法为例，其运算结果的种类将高达2的128次方种，即：340282366920938463463374607431768211456，以现有的计算机的算法，是不可能进行穷举式的暴力破解的！如果是256位算法，甚至更高位数的算法，更加不可能暴力破解！

常见的消息算法有：

- MD（Message Digest）系列
  - MD2(128位，不推荐) / MD4(128位，不推荐) / MD5(128位)
- SHA（Secure Hash Algorithm）家族
  - SHA-1(160位，不推荐) / SHA-256(256位) / SHA-384(384位) / SHA-512(512位)

#### CMD5密码破解:https://www.cmd5.com/

在Spring Boot项目中，已有`DigestUtils`工具类，提供了使用MD5算法进行编码的API：

关于消息摘要算法的破解：所有消息摘要算法都是不可逆向运算的，尝试将消息摘要运算结果运算还原出原本数据的思路本身就是错误的！一个成熟可靠的消息摘要算法，理论上，极难找出2个不同的原始数据对应相同的摘要，如果出现了这样的情况，称之“碰撞”，关于消息摘要算法的破解，本身是研究碰撞，与逆向运算无关！

如果需要根据使用消息算法编码得到的密文还原出密码的原文，常见做法是使用穷举法，记录各原文与密文的对应关系，当需要“破解”时，本质上是在执行查询操作！

| 原文（消息） | 密文（摘要）                       |
| ------------ | ---------------------------------- |
| `000000`     | `670b14728ad9902aecba32e22fa4f6bd` |
| `111111`     | `96e79218965eb72c92a549dd5a330112` |
| `222222`     | `e3ceb5881a0a1fdaad01296d7554868d` |
| `333333`     | `1a100d2c0dab19c4430e7d73762b3423` |
| `444444`     | `73882ab1fa529d7273da0db6b49cc4f3` |
| `555555`     | `5b1b68a9abf4d2cd155c81a9225fd158` |

其实，这样的做法能够“破解”的密码是**非常有限**的！假设密码可以使用所有的可打印字符（共计95种），如果密码的长度只有1位，则可以有95种不同的密码，如果密码的长度有2位，则可以有95 x 95种不同的密码，以此类推，如果密码的长度有6位，则可以有735,091,890,625种（7350亿种）不同的密码，如果密码的长度有8位，则可以有6,634,204,312,890,625种（约6634万亿种）不同的密码，所以，如果需要反查出任何8位长度的密码，则需要记录下6600多万亿条数据才可以！

所以，最有效的保证密码安全的做法是要求用户使用**安全强度更高的密码**，例如密码至少有8位，且密码中必须同时包含字母、数字、标点符号等。

为了进一步提高密码的安全性，在编码过程中，还应该使用“盐值”，盐值是一个自定义的字符串，它应该与原密码一并作为消息摘要算法的被运算数据，则对于算法而言，被运算数据就不再只是简单的密码原文而已，则密码原文与盐值组合的结果，例如：

```java
String salt = "75ifDV8rqHLfrFw87TFylDGSLGah";
String rawPassword = "000000";
String encodedPassword = DigestUtils
            .md5DigestAsHex((salt + rawPassword + salt).getBytes());
System.out.println("原文：" + rawPassword);
System.out.println("密文：" + encodedPassword);
```

不过，尽管加盐可以非常有效的防止密码被反查，但是，如果算法、运算参数（例如盐值等）、密文同时被泄露，依然可能会被**穷举式的暴力破解**。

目前，更推荐使用BCrypt算法对密码加密进行处理，这种算法默认就使用了随机的盐，并且，将盐值作为加密结果的一部分，以此保证密文是可以被验证的！更重要的是，BCrypt算法被设计为**非常非常慢**的算法，

总的来说，要最大限度的保证密码安全，应该：

- 要求用户使用安全强度更高的密码
- 加盐
- 多重加密
- 使用安全系数更强的算法
- 综合以上做法

------

## 密码加盐概念:

#### 一、密码加盐：

在面对这个网络世界的时候，密码安全总是各个公司和用户都非常关心的一个内容，毕竟现在大家不管是休闲娱乐还是学习购物都是通过网上的帐号来进行消费的，所以我们通常会给用户的密码进行加密。在加密的时候，经常会听到“加盐”这个词，这是什么意思呢？

我们通常会将用户的密码进行 Hash 加密，如果不加盐，即使是两层的 md5 都有可能通过彩虹表的方式进行破译。彩虹表就是在网上搜集的各种字符组合的 Hash 加密结果。而加盐，就是人为的通过一组随机字符与用户原密码的组合形成一个新的字符，从而增加破译的难度。就像做饭一样，加点盐味道会更好。                                           

#### 二、密码未加盐的实例：

​       在几年前 CSDN 的帐号泄露事件中，大家发现作为中文程序员世界最大的网站竟然是明文存储的密码，这就为攻击者提供了一大堆用户的明文常用密码。因为大家都喜欢用同一个用户名和密码注册不同的网站，所以不管其他怎么加盐都是没用的，毕竟原文密码是对的，拿到这样一个网站的数据库中的用户明文密码后，就可以通过这些密码去尝试这些用户在其他网站是不是用了相同的帐号名和密码注册了帐号。所以在日常生活中，我们重要的一些网站帐号、密码尽量还是使用不同的内容，如果记不住的话，可以使用一些带加密能力的记事本软件进行保存，这样会更加安全。而我们程序员，则应该始终都将用户的密码及重要信息进行加密处理，这是一种基本的职业规范。

#### 三、密码加盐的含义与用法:

  加盐加密是一种对系统登录口令的加密方式，它实现的方式是将每一个口令同一个叫做”盐“（salt）的n位随机数相关联。无论何时只要口令改变，随机数就改变。随机数以未加密的方式存放在口令文件中，这样每个人都可以读。不再只保存加密过的口令，而是先将口令和随机数连接起来然后一同加密，加密后的结果放在口令文件中。

 盐字符串是要存到数据库中的。在登录的时候还需要将用户的原文密码与这个盐字符串进行组合加密之后才能进行密码的匹配。

## 常见的加密算法分类:

常见的加密算法可以分成三类，对称加密算法，非对称加密算法和Hash算法。

#### 对称加密

指加密和解密使用相同密钥的加密算法。对称加密算法的优点在于加解密的高速度和使用长密钥时的难破解性。假设两个用户需要使用对称加密方法加密然后交换数据，则用户最少需要2个密钥并交换使用，如果企业内用户有n个，则整个企业共需要n×(n-1) 个密钥，密钥的生成和分发将成为企业信息部门的恶梦。对称加密算法的安全性取决于加密密钥的保存情况，但要求企业中每一个持有密钥的人都保守秘密是不可能的，他们通常会有意无意的把密钥泄漏出去——如果一个用户使用的密钥被入侵者所获得，入侵者便可以读取该用户密钥加密的所有文档，如果整个企业共用一个加密密钥，那整个企业文档的保密性便无从谈起。

常见的对称加密算法：DES、3DES、DESX、Blowfish、IDEA、RC4、RC5、RC6和AES

#### 非对称加密

指加密和解密使用不同密钥的加密算法，也称为公私钥加密。假设两个用户要加密交换数据，双方交换公钥，使用时一方用对方的公钥加密，另一方即可用自己的私钥解密。如果企业中有n个用户，企业需要生成n对密钥，并分发n个公钥。由于公钥是可以公开的，用户只要保管好自己的私钥即可，因此加密密钥的分发将变得十分简单。同时，由于每个用户的私钥是唯一的，其他用户除了可以可以通过信息发送者的公钥来验证信息的来源是否真实，还可以确保发送者无法否认曾发送过该信息。非对称加密的缺点是加解密速度要远远慢于对称加密，在某些极端情况下，甚至能比非对称加密慢上1000倍。

常见的非对称加密算法：RSA、ECC（移动设备用）、Diffie-Hellman、El Gamal、DSA（数字签名用）

#### Hash算法

Hash算法特别的地方在于它是一种单向算法，用户可以通过Hash算法对目标信息生成一段特定长度的唯一的Hash值，却不能通过这个Hash值重新获得目标信息。因此Hash算法常用在不可还原的密码存储、信息完整性校验等。

常见的Hash算法：MD2、MD4、MD5、HAVAL、SHA、SHA-1、HMAC、HMAC-MD5、HMAC-SHA1

加密算法的效能通常可以按照算法本身的复杂程度、密钥长度（密钥越长越安全）、加解密速度等来衡量。上述的算法中，除了DES密钥长度不够、MD2速度较慢已逐渐被淘汰外，其他算法仍在目前的加密系统产品中使用。